<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ticket Purchase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Purchase Tickets</h1>
        <form id="ticketForm" class="needs-validation" novalidate>
            <!-- Concert Selection -->
            <div class="mb-3">
                <label for="concertId" class="form-label">Select Concert</label>
                <select class="form-select" id="concertId" name="concertId" required>
                    <option value="" selected disabled>Select a concert</option>
                    <option value="1">Concert 1</option>
                    <option value="2">Concert 2</option>
                    <option value="3">Concert 3</option>
                </select>
                <div class="invalid-feedback">Please select a concert.</div>
            </div>

            <!-- Name -->
            <div class="mb-3">
                <label for="name" class="form-label">Full Name</label>
                <input type="text" class="form-control" id="name" name="name" maxlength="100" required>
                <div class="invalid-feedback">Please enter your name (max 100 characters).</div>
            </div>

            <!-- Email -->
            <div class="mb-3">
                <label for="email" class="form-label">Email</label>
                <input type="email" class="form-control" id="email" name="email" required>
                <div class="invalid-feedback">Please enter a valid email.</div>
            </div>

            <!-- Phone -->
            <div class="mb-3">
                <label for="phone" class="form-label">Phone Number</label>
                <input type="tel" class="form-control" id="phone" name="phone" required>
                <div class="invalid-feedback">Please enter a valid phone number.</div>
            </div>

            <!-- Ticket Quantity -->
            <div class="mb-3">
                <label for="quantity" class="form-label">Number of Tickets</label>
                <input type="number" class="form-control" id="quantity" name="quantity" min="1" max="10" required>
                <div class="invalid-feedback">Please enter a quantity between 1 and 10.</div>
            </div>

            <!-- Credit Card -->
            <div class="mb-3">
                <label for="creditCard" class="form-label">Credit Card Number</label>
                <input type="text" class="form-control" id="creditCard" name="creditCard" pattern="\d{15,16}" required>
                <div class="invalid-feedback">Enter a valid credit card number (15-16 digits).</div>
            </div>

            <!-- Expiration Date -->
            <div class="mb-3">
                <label for="expiration" class="form-label">Expiration Date (MM/YY)</label>
                <input type="text" class="form-control" id="expiration" name="expiration" pattern="(0[1-9]|1[0-2])\/\d{2}" required>
                <div class="invalid-feedback">Format must be MM/YY.</div>
            </div>

            <!-- Security Code -->
            <div class="mb-3">
                <label for="securityCode" class="form-label">Security Code (CVV)</label>
                <input type="text" class="form-control" id="securityCode" name="securityCode" pattern="\d{3,4}" required>
                <div class="invalid-feedback">Enter a 3 or 4-digit security code.</div>
            </div>

            <!-- Address -->
            <div class="mb-3">
                <label for="address" class="form-label">Street Address</label>
                <input type="text" class="form-control" id="address" name="address" maxlength="100" required>
                <div class="invalid-feedback">Please enter your address (max 100 characters).</div>
            </div>

            <!-- City -->
            <div class="mb-3">
                <label for="city" class="form-label">City</label>
                <input type="text" class="form-control" id="city" name="city" maxlength="100" required>
                <div class="invalid-feedback">Please enter your city (max 100 characters).</div>
            </div>

            <!-- Province -->
            <div class="mb-3">
                <label for="province" class="form-label">Province</label>
                <input type="text" class="form-control" id="province" name="province" maxlength="50" required>
                <div class="invalid-feedback">Please enter your province (max 50 characters).</div>
            </div>

            <!-- Postal Code -->
            <div class="mb-3">
                <label for="postalCode" class="form-label">Postal Code (A1A 1A1)</label>
                <input type="text" class="form-control" id="postalCode" name="postalCode" pattern="^[ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ]\s?[0-9][ABCEGHJKLMNPRSTVWXYZ][0-9]$" required>
                <div class="invalid-feedback">Format: A1A 1A1</div>
            </div>

            <!-- Country -->
            <div class="mb-3">
                <label for="country" class="form-label">Country</label>
                <input type="text" class="form-control" id="country" name="country" maxlength="100" required>
                <div class="invalid-feedback">Please enter your country (max 100 characters).</div>
            </div>

            <!-- Submit button -->
            <button type="submit" class="btn btn-primary w-100">Purchase</button>
        </form>
    </div>

    <script>
        document.getElementById('ticketForm').addEventListener('submit', function (event) {
            event.preventDefault();  // Prevents the form from submitting the traditional way

            // Create an object to hold the form data
            const formData = {
                concertId: parseInt(document.getElementById('concertId').value),  // Ensure concertId is treated as a number
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                quantity: parseInt(document.getElementById('quantity').value),  // Ensure quantity is treated as a number
                creditCard: document.getElementById('creditCard').value,
                expiration: document.getElementById('expiration').value,
                securityCode: document.getElementById('securityCode').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                province: document.getElementById('province').value,
                postalCode: document.getElementById('postalCode').value,
                country: document.getElementById('country').value
            };

            // Log the formData to ensure it's correct
            console.log('Form Data:', formData);

            // Post the data to your API using fetch
            fetch('https://nscc-0499018-tickethub-a7fhcachafevfmhz.canadacentral-01.azurewebsites.net/api/Purchase', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',  // We are sending JSON
                },
                body: JSON.stringify(formData)  // Convert the form data into a JSON string
            })
            .then(response => response.json().then(data => ({ status: response.status, body: data })))  // Capture response status and body
            .then(result => {
                console.log('Response:', result);  // Log the full response for debugging
                if (result.status >= 400) {
                    throw new Error('Error from server: ' + JSON.stringify(result.body));  // Handle server errors
                }
                alert('Ticket purchase was successful!');
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error processing your purchase.');
            });
        });
        </script>
        
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
